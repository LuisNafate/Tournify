<div class="team-detail-container">
  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando equipo...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error && !loading" class="error-container">
    <p class="error-message">{{ error }}</p>
    <button class="btn-retry" (click)="loadTeam(team?.id || '')">Reintentar</button>
    <button class="btn-back" (click)="goBack()">Volver a Mis Equipos</button>
  </div>

  <!-- Team Detail -->
  <div *ngIf="team && !loading" class="team-detail">
    <!-- Header -->
    <div class="team-header">
      <button class="btn-back-icon" (click)="goBack()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
        Volver
      </button>

      <div class="team-header-content">
        <!-- Logo -->
        <div class="team-logo-large">
          <img *ngIf="team.logoUrl" [src]="team.logoUrl" [alt]="team.name">
          <div *ngIf="!team.logoUrl" class="default-logo-large">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
              <circle cx="9" cy="7" r="4"/>
              <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
          </div>
        </div>

        <!-- Info -->
        <div class="team-info-header">
          <h1>{{ team.name }}</h1>
          <p *ngIf="team.shortName" class="team-short-name">{{ team.shortName }}</p>
          <p *ngIf="team.description" class="team-description">{{ team.description }}</p>

          <!-- Contact Info -->
          <div class="contact-info" *ngIf="team.contactEmail || team.contactPhone">
            <div class="contact-item" *ngIf="team.contactEmail">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                <polyline points="22,6 12,13 2,6"/>
              </svg>
              <span>{{ team.contactEmail }}</span>
            </div>
            <div class="contact-item" *ngIf="team.contactPhone">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
              </svg>
              <span>{{ team.contactPhone }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Members Section -->
    <div class="members-section">
      <div class="section-header">
        <h2>
          Miembros del Equipo
          <span class="member-count" *ngIf="team.members">({{ team.members.length }})</span>
        </h2>
        <button
          *ngIf="isCaptain()"
          class="btn-add-member"
          (click)="toggleAddMemberForm()">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="8.5" cy="7" r="4"/>
            <line x1="20" y1="8" x2="20" y2="14"/>
            <line x1="23" y1="11" x2="17" y2="11"/>
          </svg>
          Agregar Miembro
        </button>
      </div>

      <!-- Add Member Form -->
      <div *ngIf="showAddMemberForm" class="add-member-form">
        <h3>Nuevo Miembro</h3>
        <form [formGroup]="addMemberForm" (ngSubmit)="onSubmitAddMember()">
          <div class="form-row">
            <div class="form-group">
              <label for="email">Email *</label>
              <input
                type="email"
                id="email"
                formControlName="email"
                placeholder="ejemplo@email.com"
                [class.error]="addMemberForm.get('email')?.invalid && addMemberForm.get('email')?.touched">
              <span
                class="error-message"
                *ngIf="addMemberForm.get('email')?.invalid && addMemberForm.get('email')?.touched">
                Email válido requerido
              </span>
            </div>

            <div class="form-group">
              <label for="name">Nombre</label>
              <input
                type="text"
                id="name"
                formControlName="name"
                placeholder="Nombre completo">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="role">Rol *</label>
              <select id="role" formControlName="role">
                <option *ngFor="let role of availableRoles" [value]="role">
                  {{ getRoleName(role) }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label for="jerseyNumber">Número de Camiseta</label>
              <input
                type="number"
                id="jerseyNumber"
                formControlName="jerseyNumber"
                placeholder="1-99"
                min="1"
                max="99">
            </div>

            <div class="form-group">
              <label for="position">Posición</label>
              <input
                type="text"
                id="position"
                formControlName="position"
                placeholder="ej: Delantero">
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn-cancel"
              (click)="toggleAddMemberForm()"
              [disabled]="isSubmitting">
              Cancelar
            </button>
            <button
              type="submit"
              class="btn-submit"
              [disabled]="addMemberForm.invalid || isSubmitting">
              <span *ngIf="!isSubmitting">Agregar</span>
              <span *ngIf="isSubmitting">
                <span class="spinner-small"></span>
                Agregando...
              </span>
            </button>
          </div>
        </form>
      </div>

      <!-- Members List -->
      <div *ngIf="team.members && team.members.length > 0" class="members-list">
        <div
          *ngFor="let member of team.members"
          class="member-card"
          [class.is-captain]="member.userId === team.captainId">

          <!-- Jersey Number Badge -->
          <div class="jersey-badge" *ngIf="member.jerseyNumber">
            #{{ member.jerseyNumber }}
          </div>

          <!-- Member Info -->
          <div class="member-info">
            <div class="member-header">
              <h4>{{ member.name || member.email }}</h4>
              <span class="role-badge" [class]="'role-' + member.role">
                {{ getRoleName(member.role) }}
              </span>
            </div>

            <div class="member-details">
              <p class="member-email">{{ member.email }}</p>
              <p *ngIf="member.position" class="member-position">{{ member.position }}</p>
            </div>

            <p class="member-joined">
              Unido el {{ member.joinedAt | date:'dd/MM/yyyy' }}
            </p>
          </div>

          <!-- Actions -->
          <div class="member-actions" *ngIf="isCaptain() && member.userId !== team.captainId">
            <button
              class="btn-remove"
              (click)="removeMember(member, $event)"
              title="Eliminar miembro">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!team.members || team.members.length === 0" class="empty-members">
        <svg class="empty-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
        <h3>No hay miembros en el equipo</h3>
        <p *ngIf="isCaptain()">Agrega miembros para completar tu equipo</p>
        <p *ngIf="!isCaptain()">El capitán puede agregar miembros al equipo</p>
      </div>
    </div>
  </div>
</div>
