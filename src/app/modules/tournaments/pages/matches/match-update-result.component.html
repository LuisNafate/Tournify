<div class="update-container" *ngIf="!loading && !error && match">
  <!-- Header -->
  <div class="update-header">
    <button class="back-button" (click)="cancel()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg> Volver
    </button>
    <h1>Actualizar Resultado</h1>
  </div>

  <!-- Match Info Banner -->
  <div class="match-info-banner">
    <div class="team-info">
      <div class="team-logo">
        <div class="team-initials">{{ getTeamInitials(match.homeTeam?.name || match.homeTeamName || 'EL') }}</div>
      </div>
      <div class="team-labels">
        <span class="team-role">Equipo Local</span>
        <span class="team-name">{{ match.homeTeam?.name || match.homeTeamName || 'Equipo Local' }}</span>
      </div>
    </div>
    <div class="vs">VS</div>
    <div class="team-info">
      <div class="team-logo">
        <div class="team-initials">{{ getTeamInitials(match.awayTeam?.name || match.awayTeamName || 'EV') }}</div>
      </div>
      <div class="team-labels">
        <span class="team-role">Equipo Visitante</span>
        <span class="team-name">{{ match.awayTeam?.name || match.awayTeamName || 'Equipo Visitante' }}</span>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="quick-actions" *ngIf="match.status !== 'finished' && match.status !== 'cancelled'">
    <button 
      class="action-btn start-btn" 
      (click)="startMatch()"
      *ngIf="match.status !== 'live'"
    >
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 8px;">
        <polygon points="5 3 19 12 5 21 5 3"/>
      </svg> Iniciar Partido
    </button>
    <button 
      class="action-btn finish-btn" 
      (click)="finishMatch()"
      *ngIf="match.status === 'live'"
    >
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 8px;">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
              <polyline points="22 4 12 14.01 9 11.01"/>
      </svg> Finalizar Partido
    </button>
  </div>

  <!-- Update Form -->
  <form [formGroup]="updateForm" (ngSubmit)="onSubmit()" class="update-form">
    <!-- Scores Section -->
    <div class="scores-section">
      <h3>Marcador</h3>
      <div class="scores-grid">
        <div class="score-input-group">
          <label>{{ match.homeTeam?.name || 'Equipo Local' }}</label>
          <input 
            type="number" 
            formControlName="scoreHome"
            min="0"
            class="score-input"
          />
          <div class="error-message" *ngIf="updateForm.get('scoreHome')?.invalid && updateForm.get('scoreHome')?.touched">
            Ingresa un marcador válido
          </div>
        </div>

        <div class="score-divider">-</div>

        <div class="score-input-group">
          <label>{{ match.awayTeam?.name || 'Equipo Visitante' }}</label>
          <input 
            type="number" 
            formControlName="scoreAway"
            min="0"
            class="score-input"
          />
          <div class="error-message" *ngIf="updateForm.get('scoreAway')?.invalid && updateForm.get('scoreAway')?.touched">
            Ingresa un marcador válido
          </div>
        </div>
      </div>
    </div>

    <!-- Status Section -->
    <div class="form-group">
      <label for="status">Estado del Partido</label>
      <select id="status" formControlName="status" class="form-control">
        <option *ngFor="let option of statusOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>

    <!-- Notes Section -->
    <div class="form-group">
      <label for="notes">Notas / Observaciones</label>
      <textarea 
        id="notes" 
        formControlName="notes" 
        class="form-control"
        rows="4"
        placeholder="Incidencias, tarjetas, lesiones, etc."
      ></textarea>
    </div>

    <!-- Winner Preview -->
    <div class="winner-preview" *ngIf="updateForm.value.scoreHome !== updateForm.value.scoreAway && updateForm.value.status === 'finished'">
      <div class="preview-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
        <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
        <path d="M4 22h16"/>
        <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/>
        <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
        <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
        </svg>
      </div>
      <div class="preview-text">
        Ganador: 
        <strong>
          {{ updateForm.value.scoreHome > updateForm.value.scoreAway ? match.homeTeam?.name : match.awayTeam?.name }}
        </strong>
      </div>
    </div>

    <!-- Error Message -->
    <div class="form-error" *ngIf="error">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px; margin-right: 8px;">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="12"/>
        <line x1="12" y1="16" x2="12.01" y2="16"/>
      </svg>
      {{ error }}
    </div>

    <!-- Action Buttons -->
    <div class="form-actions">
      <button type="button" class="btn-cancel" (click)="cancel()" [disabled]="saving">
        Cancelar
      </button>
      <button type="submit" class="btn-save" [disabled]="updateForm.invalid || saving">
        <span *ngIf="!saving">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; margin-right: 8px;">
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
          <polyline points="17 21 17 13 7 13 7 21"/>
          <polyline points="7 3 7 8 15 8"/>
        </svg>
        Guardar Cambios
      </span>
        <span *ngIf="saving">Guardando...</span>
      </button>
    </div>
  </form>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <div class="spinner"></div>
  <p>Cargando partido...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error && !match">
  <div class="error-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 32px; height: 32px; margin-bottom: 16px;">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
      </div>
  <p>{{ error }}</p>
  <button class="retry-button" (click)="loadMatch()">Reintentar</button>
</div>
